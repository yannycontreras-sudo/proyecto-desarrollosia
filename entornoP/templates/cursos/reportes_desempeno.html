{% extends "home.html" %}
{% block content %}

<div class="container py-5">
    <h2>Reportes de Progreso y Rendimiento</h2>

    <form method="get" class="mb-4">
        <div class="form-row">
            <div class="form-group col-md-4">
                <label>Curso:</label>
                <select name="curso" class="form-control">
                    <option value="">Todos</option>
                    {% for c in cursos %}
                        <option value="{{ c.id }}"
                            {% if request.GET.curso|stringformat:'s' == c.id|stringformat:'s' %}
                                selected
                            {% endif %}
                        >
                            {{ c.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group col-md-4">
                <label>Docente:</label>
                <select name="docente" class="form-control">
                    <option value="">Todos</option>
                    {% for d in docentes %}
                        <option value="{{ d.id }}"
                            {% if request.GET.docente|stringformat:'s' == d.id|stringformat:'s' %}
                                selected
                            {% endif %}
                        >
                            {{ d.get_full_name|default:d.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group col-md-2">
                <label>Periodo (a√±o):</label>
                <input type="text" name="periodo" class="form-control"
                       value="{{ request.GET.periodo }}" placeholder="Ej: 2024">
            </div>

            <div class="form-group col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary btn-block">Filtrar</button>
            </div>
        </div>
    </form>

    <hr>

    <h4>Resumen por curso</h4>
    <canvas id="grafico"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    const ctx = document.getElementById('grafico');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ etiquetas|safe }},
            datasets: [{
                label: 'Puntaje promedio por curso',
                data: {{ promedios|safe }},
                borderWidth: 1
            }]
        }
    });
    </script>

    <hr>

    <a href="{% url 'cursos:exportar_reporte_csv' %}?{{ request.GET.urlencode }}" class="btn btn-outline-secondary">
        Exportar CSV
    </a>
</div>

{% endblock content %}
