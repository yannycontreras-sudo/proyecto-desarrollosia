{% extends "home.html" %}

{% block title %}Respuestas del formulario #{{ formulario.id }}{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4">
        Respuestas del Formulario #{{ formulario.id }}
    </h1>
    <p class="text-muted">
        Contenido: <strong>{{ formulario.contenido.titulo }}</strong>
    </p>

    {% if evaluaciones %}
        <table class="table table-striped table-bordered mt-4">
            <thead class="thead-light">
                <tr>
                    <th>Alumno</th>
                    <th>Fecha</th>
                    <th>Puntaje</th>
                    <th>Aprobado</th>
                    <th>Detalle</th>
                </tr>
            </thead>
            <tbody>
                {% for eva in evaluaciones %}
                    <tr>
                        <td>{{ eva.usuario }}</td>
                        <td>{{ eva.fecha|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if eva.puntaje is not None %}
                                {{ eva.puntaje }} %
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td>
                            {% if eva.aprobado %}
                                <span class="badge badge-success">Sí</span>
                            {% else %}
                                <span class="badge badge-danger">No</span>
                            {% endif %}
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary"
                                    type="button"
                                    data-toggle="collapse"
                                    data-target="#eva{{ eva.id }}">
                                Ver respuestas
                            </button>
                        </td>
                    </tr>
                    <tr class="collapse" id="eva{{ eva.id }}">
                        <td colspan="5">
                            <ul class="list-group">
                                {% for r in eva.respuestas.all %}
                                    <li class="list-group-item">
                                        <strong>{{ r.pregunta.texto }}</strong><br>
                                        {% if r.opcion %}
                                            Respuesta: {{ r.opcion.texto }}<br>
                                            {% if r.opcion.es_correcta %}
                                                <span class="badge badge-success">Correcta</span>
                                            {% else %}
                                                <span class="badge badge-danger">Incorrecta</span>
                                            {% endif %}
                                        {% elif r.respuesta_texto %}
                                            Respuesta abierta:<br>
                                            <em>{{ r.respuesta_texto }}</em>
                                        {% else %}
                                            <em>Sin respuesta</em>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-muted mt-4">
            Aún no hay respuestas para este formulario.
        </p>
    {% endif %}

    <a href="{% url 'cursos:detalle' formulario.contenido.modulo.curso.id %}"
       class="btn btn-link mt-3">
        Volver al curso
    </a>
</div>
{% endblock %}
