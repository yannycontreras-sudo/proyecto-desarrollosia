{% extends "home.html" %}

{% block title %}Simulación - {{ simulacion.nombre }}{% endblock title %}

{% block content %}
<div class="container py-4">

    <!-- CABECERA -->
    <h2 class="mb-3">
        Simulación: {{ simulacion.nombre }}
    </h2>
    <p class="text-muted">
        Curso: {{ curso.nombre }}<br>
        Módulo: {{ modulo.titulo }}
    </p>

    {% if simulacion.descripcion %}
        <div class="alert alert-info">
            {{ simulacion.descripcion }}
        </div>
    {% endif %}

    <hr>

    <!-- MATERIAL PRINCIPAL DE LA SIMULACIÓN -->
    <h4 class="mb-3">Material de la simulación</h4>

    {# VIDEO PRINCIPAL CARGADO EN LA SIMULACIÓN #}
    {% if simulacion.video %}
        <div class="mb-4">
            <h5>Video principal de la simulación</h5>
            <video controls style="width: 100%; max-width: 900px; display:block; margin-bottom:10px;">
                <source src="{{ simulacion.video.url }}" type="video/mp4">
                Tu navegador no soporta videos.
            </video>
        </div>
        <hr>
    {% endif %}

    {# IMAGEN PRINCIPAL DE LA SIMULACIÓN (SI EXISTE) #}
    {% if simulacion.imagen %}
        <div class="mb-4">
            <h5>Imagen asociada</h5>
            <img src="{{ simulacion.imagen.url }}"
                 alt="Imagen de la simulación"
                 style="width: 100%; max-width: 900px; display:block; margin-bottom:10px;">
        </div>
        <hr>
    {% endif %}

    {# CONTENIDO HTML / INSTRUCCIONES (SI USAS ESTE CAMPO) #}
    {% if simulacion.contenido_html %}
        <div class="alert alert-secondary">
            {{ simulacion.contenido_html|safe }}
        </div>
        <hr>
    {% endif %}

    <!-- CONTENIDOS DEL MÓDULO LIGADOS A LA SIMULACIÓN -->
    {% if contenidos %}
        {% for contenido in contenidos %}
            <div class="mb-4">

                <h5>{{ contenido.titulo }}</h5>

                {# VIDEO EN GRANDE #}
                {% if contenido.archivo and contenido.es_video %}
                    <video controls style="width: 100%; max-width: 500px; display:block; margin: 0 auto 15px auto; border-radius: 8px;">
                        <source src="{{ contenido.archivo.url }}" type="video/mp4">
                        Tu navegador no soporta videos.
                    </video>

                {# IMAGEN EN GRANDE #}
                {% elif contenido.archivo and contenido.es_imagen %}
                    <img src="{{ contenido.archivo.url }}"
                         alt="{{ contenido.titulo }}"
                         style="width: 100%; max-width: 900px; display:block; margin-bottom:10px;">

                {# OTRO TIPO DE ARCHIVO #}
                {% elif contenido.archivo %}
                    <a href="{{ contenido.archivo.url }}"
                       class="btn btn-outline-primary"
                       target="_blank">
                        Ver recurso
                    </a>
                {% endif %}

                {% if contenido.descripcion %}
                    <p class="text-muted mb-0">
                        {{ contenido.descripcion }}
                    </p>
                {% endif %}

            </div>
            <hr>
        {% endfor %}
    {% else %}
        <p class="text-muted">
            Este módulo no tiene contenidos adicionales cargados para la simulación.
        </p>
    {% endif %}

    <!-- BOTONES FINALES -->
    <div class="mt-4">
        {% if formulario %}
            <a href="{% url 'cursos:responder_formulario' formulario_id=formulario.id %}"
               class="btn btn-success btn-lg">
                Responder evaluación de la simulación
            </a>
        {% endif %}

        <a href="{% url 'cursos:detalle' curso.pk %}"
           class="btn btn-secondary btn-lg ml-2">
            Volver al curso
        </a>
    </div>

</div>
{% endblock content %}
